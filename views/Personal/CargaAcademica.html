{# Personal/CargaAcademica.html #}
{% extends 'default_layout.html' %}

{% block extraCSS %}
<style>
    /* Animación suave para la aparición de contenidos */
    .fade-in { animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    .cursor-pointer { cursor: pointer; }
    
    /* Ajuste para Select2 con Floating Labels */
    .form-floating .select2-container .select2-selection {
        height: 58px;
        padding-top: 1.625rem;
        padding-bottom: 0.625rem;
    }
</style>
{% endblock %}

{% block javascripts %}
  <script src="js/Personal/CargaAcademica.js"></script>
  <script src="js/Utilidades/cargarDatosSelect.js"></script>
  <script src="js/Utilidades/utilidadesSelect.js"></script>

  <script>
    $(document).ready(function () { 
        // Inicialización de Select2 con tema Bootstrap 5
        $('.select2').select2({
            theme: 'bootstrap-5',
            width: '100%',
            placeholder: 'Seleccione una opción'
        });
    });
  </script>
{% endblock %}

{% block contenidos %}
<div class="content-wrapper fondoBody">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="fw-bold text-dark"><i class="fas fa-chalkboard-teacher"></i> Carga Académica</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-end">
                        <li class="breadcrumb-item"><a href="index.php">Inicio</a></li>
                        <li class="breadcrumb-item active">Gestión Docente</li>
                    </ol>
                </div>
            </div>
        </div>
    </section>

    <section class="content">
        <div class="container-fluid">
            
            <div class="row justify-content-center" id="PersonalDocente">
                <div class="col-md-6">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0"><i class="fas fa-user-tie me-2"></i> Seleccionar Docente</h5>
                        </div>
                        <div class="card-body">
                            <form id="formSeleccionDocente">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="lstannlectivo" name="lstannlectivo" aria-label="Año Lectivo"></select>
                                    <label for="lstannlectivo">Año Lectivo</label>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="lstCodigoPersonal" class="form-label text-muted small">Nombre del Docente</label>
                                    <select class="form-select select2" id="lstCodigoPersonal" name="lstCodigoPersonal"></select>
                                </div>

                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button type="button" class="btn btn-primary" id="goCABuscar">
                                        <i class="fas fa-search me-1"></i> Buscar Carga
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="goCAImprimir">
                                        <i class="fas fa-print me-1"></i> Imprimir
                                    </button>
                                    <button type="button" class="btn btn-danger" id="goCancelar" style="display:none;">
                                        <i class="fas fa-times me-1"></i> Cerrar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-3 fade-in" id="CargaAcademicaContenedor" style="display: none;">
                <div class="col-12">
                    <div class="card shadow border-0">
                        <div class="card-header p-0 pt-1 border-bottom-0">
                            <ul class="nav nav-tabs" id="tabsCarga" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="tab-encargado" data-bs-toggle="pill" href="#panel-encargado" role="tab">
                                        <i class="fas fa-user-graduate me-2"></i> Encargado de Grado
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="tab-asignar" data-bs-toggle="pill" href="#panel-asignar" role="tab">
                                        <i class="fas fa-book-open me-2"></i> Asignaturas (Carga)
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="tab-excel" data-bs-toggle="pill" href="#panel-excel" role="tab">
                                        <i class="fas fa-file-excel me-2"></i> Hoja de Cálculo
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="card-body">
                            <div class="tab-content" id="tabsCargaContent">
                                
                                <div class="tab-pane fade show active" id="panel-encargado" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="p-3 bg-light rounded border">
                                                <h6 class="text-primary mb-3">Asignar Grado</h6>
                                                <form id="formEncargado">
                                                    <div class="form-floating mb-2">
                                                        <select class="form-select" id="lstCodigoModalidad"></select>
                                                        <label>Modalidad</label>
                                                    </div>
                                                    <div class="form-floating mb-3">
                                                        <select class="form-select" id="lstCodigoGSTEG"></select>
                                                        <label>Grado - Sección - Turno</label>
                                                    </div>
                                                    
                                                    <div class="form-check form-switch mb-2">
                                                        <input class="form-check-input" type="checkbox" id="EG1" checked>
                                                        <label class="form-check-label" for="EG1">Es Encargado de Grado</label>
                                                    </div>
                                                    <div class="form-check form-switch mb-3">
                                                        <input class="form-check-input" type="checkbox" id="IA1">
                                                        <label class="form-check-label" for="IA1">Imparte Asignatura (Otros Grados)</label>
                                                    </div>

                                                    <div class="d-grid gap-2">
                                                        <button type="button" class="btn btn-primary btn-sm" id="goBuscarEG">
                                                            <i class="fas fa-search"></i> Consultar Existente
                                                        </button>
                                                        <button type="button" class="btn btn-success" id="goAgregarEG">
                                                            <i class="fas fa-plus-circle"></i> Asignar Grado
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <h6 class="text-secondary">Grados Asignados</h6>
                                            <div class="table-responsive">
                                                <table class="table table-hover table-striped align-middle">
                                                    <thead class="table-dark">
                                                        <tr>
                                                            <th>#</th>
                                                            <th>ID</th>
                                                            <th>Modalidad</th>
                                                            <th>Grado/Sec/Turno</th>
                                                            <th class="text-center">Encargado</th>
                                                            <th class="text-center">Imparte</th>
                                                            <th class="text-center">Acción</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="listaEG">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="panel-asignar" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="p-3 bg-light rounded border">
                                                <h6 class="text-warning mb-3">Agregar Asignatura</h6>
                                                <form id="formCarga">
                                                    <div class="form-floating mb-2">
                                                        <select class="form-select" id="lstCodigoModalidadCD"></select>
                                                        <label>Modalidad</label>
                                                    </div>
                                                    <div class="form-floating mb-2">
                                                        <select class="form-select" id="lstCodigoGSTCD"></select>
                                                        <label>Grado - Sección</label>
                                                    </div>
                                                    <div class="form-floating mb-3">
                                                        <select class="form-select" id="lstCodigoAsignaturaCD"></select>
                                                        <label>Asignatura</label>
                                                    </div>
                                                    <div class="d-grid gap-2">
                                                        <button type="button" class="btn btn-primary btn-sm" id="goBuscarCD">
                                                            <i class="fas fa-sync"></i> Refrescar Lista
                                                        </button>
                                                        <button type="button" class="btn btn-success" id="goAgregarCD">
                                                            <i class="fas fa-save"></i> Guardar Asignatura
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <h6 class="text-secondary">Carga Académica Actual</h6>
                                            <div class="table-responsive">
                                                <table class="table table-hover table-striped align-middle">
                                                    <thead class="table-dark">
                                                        <tr>
                                                            <th>#</th>
                                                            <th>ID</th>
                                                            <th>Modalidad</th>
                                                            <th>Grado/Sec/Turno</th>
                                                            <th>Asignatura</th>
                                                            <th class="text-center">Acción</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="listaCD">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="panel-excel" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card border-success h-100">
                                                <div class="card-header bg-success text-white">Configurar Archivo Excel</div>
                                                <div class="card-body">
                                                    <p class="card-text text-muted">Seleccione los periodos a incluir en la hoja de cálculo.</p>
                                                    
                                                    <div class="btn-group-vertical w-100" role="group">
                                                        <input type="checkbox" class="btn-check" id="T1" autocomplete="off">
                                                        <label class="btn btn-outline-success text-start" for="T1"><i class="fas fa-check"></i> Incluir Periodo 1</label>

                                                        <input type="checkbox" class="btn-check" id="T2" autocomplete="off">
                                                        <label class="btn btn-outline-success text-start" for="T2"><i class="fas fa-check"></i> Incluir Periodo 2</label>

                                                        <input type="checkbox" class="btn-check" id="T3" autocomplete="off">
                                                        <label class="btn btn-outline-success text-start" for="T3"><i class="fas fa-check"></i> Incluir Periodo 3</label>

                                                        <input type="checkbox" class="btn-check" id="T4" autocomplete="off">
                                                        <label class="btn btn-outline-success text-start" for="T4"><i class="fas fa-check"></i> Incluir Periodo 4</label>
                                                    </div>
                                                    
                                                    <div class="form-check mt-3">
                                                        <input class="form-check-input" type="checkbox" id="Pendiente">
                                                        <label class="form-check-label fw-bold" for="Pendiente">
                                                            Solo asignaturas NO aprobadas
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="card-footer">
                                                    <button type="button" class="btn btn-success w-100" id="goCrearHC">
                                                        <i class="fas fa-file-excel fa-lg me-2"></i> Generar Archivo
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="alert alert-info">
                                                <h5><i class="icon fas fa-info"></i> Resultado</h5>
                                                <div id="Informacion" style="display:none;" class="mb-2"></div>
                                                <div id="InformacionError" class="text-danger" style="display:none;"></div>
                                                <div id="loadingExcel" class="text-center" style="display:none;">
                                                    <div class="spinner-border text-primary" role="status"></div>
                                                    <p>Procesando...</p>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <label class="fw-bold">Historial Reciente:</label>
                                                    <table class="table table-sm table-bordered bg-white">
                                                        <tbody id="listaArchivoOK"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
</div>

<div class="modal fade" id="modalConfirmarEliminar" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p class="fs-5">¿Está seguro que desea eliminar este registro?</p>
                <p class="text-muted small">Esta acción no se puede deshacer.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmarEliminar">Sí, Eliminar</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}